<%
  key = market_attribute_response.market_attribute.key
  radio_choice = market_attribute_response.radio_choice
  text = market_attribute_response.text
  documents = market_attribute_response.documents
  context ||= :web
  show_value = !market_attribute_response.auto? || context == :buyer
  market_application = market_attribute_response.market_application
  naming_service = DocumentNamingService.new(market_application)
%>

<div class="fr-grid-row fr-mb-2w">
  <div class="fr-col">
    <strong>
      <%= t("form_fields.candidate.fields.#{key}.name", default: key.humanize) %>
      <%= render 'candidate/market_applications/market_attribute_responses/source_badge', market_attribute_response: market_attribute_response %>
    </strong>

    <% if show_value %>
      <br>

      <% if radio_choice == 'yes' %>
        <% if text.present? %>
          <div class="fr-mb-2w">
            <strong class="fr-text--sm">Précisions :</strong><br>
            <%= simple_format(text, class: "fr-text--sm") %>
          </div>
        <% end %>

        <% if documents.attached? %>
          <div>
            <strong class="fr-text--sm">Documents joints :</strong><br>
            <% documents.each do |doc| %>
              <%= render 'candidate/market_applications/market_attribute_responses/shared/document_item',
                         document: doc,
                         market_application: market_application,
                         context: context,
                         naming_service: naming_service %>
            <% end %>
          </div>
        <% end %>

        <% if text.blank? && !documents.attached? %>
          <span class="fr-text--sm">Aucune information complémentaire fournie</span>
        <% end %>
      <% else %>
        <% if documents.attached? %>
          <div>
            <strong class="fr-text--sm">Documents justificatifs :</strong><br>
            <% documents.each do |doc| %>
              <%= render 'candidate/market_applications/market_attribute_responses/shared/document_item',
                         document: doc,
                         market_application: market_application,
                         context: context,
                         naming_service: naming_service %>
            <% end %>
          </div>
        <% else %>
          <span class="fr-text--sm">Aucun document justificatif fourni</span>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <div class="fr-col-auto" style="display: flex; align-items: flex-start; justify-content: flex-end;">
    <% if show_value %>
      <% if radio_choice == 'yes' %>
        <div class="fr-badge fr-badge--success fr-badge--sm fr-mb-1w">Oui</div>
      <% else %>
        <div class="fr-badge fr-badge--sm fr-mb-1w">Non</div>
      <% end %>
    <% end %>
  </div>
</div>
<hr class="fr-hr">
