<%
  echantillons_data = market_attribute_response.echantillons
  key = market_attribute_response.market_attribute.key
  has_echantillons = echantillons_data.present? && echantillons_data.values.any? { |echantillon| echantillon.present? && echantillon.any? { |_, v| v.present? } }
%>

<div class="field-layout-container">
  <div class="field-layout-content">
    <strong>
      <%= t("form_fields.candidate.fields.#{key}.name", default: key.humanize) %>
    </strong>
    <br>

    <% if has_echantillons %>
      <div class="fr-mt-2w">
        <% market_attribute_response.echantillons_ordered.each_with_index do |(timestamp, echantillon), index| %>
          <% next if echantillon.blank? || echantillon.all? { |_, v| v.blank? } %>

          <div class="fr-card fr-card--sm fr-mb-2w">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h6 class="fr-text--sm fr-mb-1w">
                  <span class="fr-icon-image-line fr-icon--sm fr-mr-1v" aria-hidden="true"></span>
                  Échantillon <%= index + 1 %>
                </h6>

                <% if echantillon['description'].present? %>
                  <div class="fr-mb-1v">
                    <strong>Description :</strong><br>
                    <%= simple_format(echantillon['description'], class: 'fr-text--sm') %>
                  </div>
                <% end %>

                <% if echantillon['fichiers'].present? %>
                  <% fichiers = market_attribute_response.echantillon_fichiers(timestamp) %>
                  <% if fichiers.any? %>
                    <div class="fr-mb-1v">
                      <strong><%= fichiers.size == 1 ? 'Fichier' : 'Fichiers' %> :</strong>
                      <ul class="fr-text--sm fr-mt-1v">
                        <% fichiers.each do |fichier| %>
                          <li>
                            <span class="fr-icon-file-fill fr-icon--sm fr-mr-1v" aria-hidden="true"></span>
                            <%= link_to fichier.filename.to_s,
                                        url_for(fichier),
                                        target: "_blank", rel: "noopener",
                                        class: "fr-link" %>
                            (<%= number_to_human_size(fichier.byte_size) %>)
                          </li>
                        <% end %>
                      </ul>
                    </div>
                  <% end %>
                <% end %>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <span class="fr-text--sm fr-text--mention-grey">Aucun échantillon renseigné</span>
    <% end %>
  </div>
</div>
