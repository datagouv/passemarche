<%#
  Année n-1 : 2024 Effectifs moyens : 30
  Année n-2 : 2023 Effectifs moyens : 32
  Année n-2 : 2022 Effectifs moyens : 35
%>

<%
  value_data = market_attribute_response.value || {}
  key = market_attribute_response.market_attribute.key
  context ||= :web
  # Show value if: not auto-filled, OR context is buyer (buyer sees all data)
  show_value = !market_attribute_response.auto? || context == :buyer
%>

<div class="field-layout-container">
  <div class="field-layout-content">
    <strong class="fr-text--md">
      <%= t(
        "form_fields.candidate.fields.#{key}.name",
        default: key.humanize
      ) %>
      <%= render 'candidate/market_applications/market_attribute_responses/source_badge', market_attribute_response: market_attribute_response %>
    </strong>

    <% if show_value %>
      <div class="fr-mb-3w"></div>
      <% displayed = false %>
      <% [["n-1", "year_1"], ["n-2", "year_2"], ["n-3", "year_3"]].each do |label, year_key| %>
        <% year_data = value_data[year_key] || {} %>
        <% if year_data['year'].present? || year_data['average_staff'].present? %>
          <div class="fr-mb-2w">
            <span class="fr-text--md"><strong>Année <%= label %> :</strong></span>
            <span class="fr-text--md fr-ml-1w">
              <%= year_data['year'].present? ?
                year_data['year'] :
                "<span class='fr-text--mention-grey'>Non renseigné</span>" %>
            </span>
            <span class="fr-text--md fr-ml-2w"><strong>Effectif moyen :</strong></span>
            <span class="fr-text--md fr-ml-1w">
              <%= year_data['average_staff'].present? ?
                year_data['average_staff'] :
                "<span class='fr-text--mention-grey'>Non renseigné</span>" %>
            </span>
          </div>
          <% displayed = true %>
        <% end %>
      <% end %>
      <% unless displayed %>
        <span class="fr-text--sm fr-text--mention-grey fr-mt-2w">
          Non renseigné
        </span>
      <% end %>
    <% end %>
  </div>
</div>
<hr class="fr-hr">
