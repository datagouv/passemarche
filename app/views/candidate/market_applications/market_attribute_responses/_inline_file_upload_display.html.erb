<%
  documents = market_attribute_response.documents
  context ||= :web
  show_value = !market_attribute_response.auto? || context == :buyer
  market_application = market_attribute_response.market_application
  naming_service = DocumentNamingService.new(market_application)
  has_qualiopi_metadata = market_attribute_response.respond_to?(:qualiopi_metadata?) && market_attribute_response.qualiopi_metadata?
%>

<div class="field-layout-container">
  <div class="field-layout-content">
    <strong>
      <%= t("form_fields.candidate.fields.#{market_attribute_response.market_attribute.key}.name",
            default: market_attribute_response.market_attribute.key.humanize) %>
    </strong>

    <% if show_value %>
      <br>
      <span class="fr-text--md fr-text--mention-grey">
        <% if documents.attached? %>
          <% documents.each do |doc| %>
            <%= render 'candidate/market_applications/market_attribute_responses/shared/document_item',
                       document: doc,
                       market_application: market_application,
                       context: context,
                       naming_service: naming_service %>
          <% end %>
        <% else %>
          <span class="fr-text-md fr-text--mention-grey">Aucun fichier téléchargé</span>
        <% end %>
      </span>
    <% elsif has_qualiopi_metadata %>
      <br>
      <div class="fr-text--sm fr-text--mention-grey">
        <p class="fr-mb-1v">
          <strong><%= t('form_fields.candidate.carif_oref.qualiopi.action_formation') %> :</strong>
          <%= market_attribute_response.action_formation? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
        </p>
        <p class="fr-mb-1v">
          <strong><%= t('form_fields.candidate.carif_oref.qualiopi.bilan_competences') %> :</strong>
          <%= market_attribute_response.bilan_competences? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
        </p>
        <p class="fr-mb-1v">
          <strong><%= t('form_fields.candidate.carif_oref.qualiopi.validation_acquis_experience') %> :</strong>
          <%= market_attribute_response.validation_acquis_experience? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
        </p>
        <p class="fr-mb-1v">
          <strong><%= t('form_fields.candidate.carif_oref.qualiopi.apprentissage') %> :</strong>
          <%= market_attribute_response.apprentissage? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
        </p>
        <p class="fr-mb-1v">
          <strong><%= t('form_fields.candidate.carif_oref.qualiopi.obtention_via_unite_legale') %> :</strong>
          <%= market_attribute_response.obtention_via_unite_legale? ? t('form_fields.candidate.shared.yes') : t('form_fields.candidate.shared.no') %>
        </p>
        <% if market_attribute_response.specialites.present? %>
          <p class="fr-mb-1v fr-mt-2v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.specialites') %> :</strong>
          </p>
          <ul class="fr-mb-0" style="margin-left: 1.5em;">
            <% market_attribute_response.specialites.each do |specialite| %>
              <li><%= specialite['libelle'] %></li>
            <% end %>
          </ul>
        <% end %>
      </div>
    <% end %>
  </div>
  <div class="field-layout-badge">
    <%= render 'candidate/market_applications/market_attribute_responses/source_badge', market_attribute_response: market_attribute_response %>
  </div>
</div>
<hr class="fr-hr">
