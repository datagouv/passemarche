<% if market_attribute_response.auto? %>
  <%= auto_filled_field_display(form, market_attribute_response) %>
<% else %>
<div class="fr-checkbox-group">
  <%= form.fields_for :market_attribute_responses, market_attribute_response,
                      child_index: market_attribute_response.id do |response_form| %>
    <%= response_hidden_fields(response_form) %>

    <h6 class="fr-mb-2w fr-text--md">
      <%= field_label(market_attribute_response) %>
    </h6>

    <% if field_description(market_attribute_response).present? %>
      <div class="fr-hint-text fr-mb-2w fr-text--sm">
        <%= field_description(market_attribute_response) %>
      </div>
    <% end %>

    <div class="fr-checkbox-group<%= ' fr-checkbox-group--error' if response_form.object.errors[:checked].any? %>">
      <%= response_form.check_box :checked, { class: "fr-checkbox" }, "1", "0" %>
      <%= response_form.label :checked, class: "fr-checkbox__label fr-mb-2w" do %>
        <%= t("candidate.market_applications.form_fields.#{market_attribute_response.market_attribute.key}.extra") %>
      <% end %>

      <% if response_form.object.errors[:checked].any? %>
        <p class="fr-error-text">
          <%= response_form.object.errors[:checked].first %>
        </p>
      <% end %>
    </div>

    <%= direct_upload_field documents: market_attribute_response.documents,
                            market_application_identifier: market_attribute_response.market_application.identifier,
                            deletable: true,
                            wrapper_class: 'fr-mt-2w fr-card fr-p-2w',
                            form: response_form do %>
      <%= response_form.label :files, "Ajouter vos documents", class: "fr-label fr-mb-2w fr-text--md", for: "upload-#{market_attribute_response.id}" %>
      <span class="fr-hint-text fr-mb-2w fr-text--sm">
        <%= file_upload_hint_text(MarketAttributeResponse::CheckboxWithDocument::MAX_FILE_SIZE) %>
      </span>
      <%= response_form.file_field :files,
          id: "upload-#{market_attribute_response.id}",
          class: "fr-upload",
          multiple: true,
          direct_upload: true,
          accept: ".pdf,.doc,.docx,.jpg,.jpeg,.png",
          aria: { describedby: "upload-#{market_attribute_response.id}-messages" } %>

      <div class="fr-messages-group" id="upload-<%= market_attribute_response.id %>-messages" aria-live="polite">
        <% if response_form.object.errors[:documents].present? %>
          <p class="fr-message fr-message--error">
            <%= response_form.object.errors[:documents].first %>
          </p>
        <% end %>
      </div>
    <% end %>
  <% end %>
</div>
<% end %>
