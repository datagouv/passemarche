<%
  key = market_attribute_response.market_attribute.key
  radio_choice = market_attribute_response.radio_choice || 'no'
%>

<div class="fr-input-group">
  <%= form.fields_for :market_attribute_responses, market_attribute_response do |response_form| %>
    <%= response_form.hidden_field :id %>
    <%= response_form.hidden_field :market_attribute_id %>
    <%= response_form.hidden_field :type %>

    <h6 class="fr-mb-2w fr-text--md">
      <%= t("form_fields.candidate.fields.#{key}.name", default: key.humanize) %>
    </h6>

    <div data-controller="conditional-fields">
      <div class="fr-mb-3w" style="display: flex; align-items: flex-start; justify-content: space-between; gap: 2rem;">
        <% if t("form_fields.candidate.fields.#{key}.description", default: nil).present? %>
          <div class="fr-hint-text fr-text--sm" style="flex: 1;">
            <%= t("form_fields.candidate.fields.#{key}.description") %>
          </div>
        <% end %>

        <div style="flex-shrink: 0;">
          <div style="display: flex; gap: 1rem;">
            <div class="fr-radio-group">
              <%= response_form.radio_button :radio_choice, 'yes',
                    class: "fr-radio",
                    data: {
                      action: "conditional-fields#show",
                      conditional_fields_target: "trigger"
                    } %>
              <%= response_form.label :radio_choice_yes,
                    t("form_fields.candidate.fields.#{key}.radio_yes", default: "Oui"),
                    class: "fr-label" %>
            </div>

            <div class="fr-radio-group">
              <%= response_form.radio_button :radio_choice, 'no',
                    class: "fr-radio",
                    data: {
                      action: "conditional-fields#hide",
                      conditional_fields_target: "trigger"
                    } %>
              <%= response_form.label :radio_choice_no,
                    t("form_fields.candidate.fields.#{key}.radio_no", default: "Non"),
                    class: "fr-label" %>
            </div>
          </div>
        </div>
      </div>

      <div data-conditional-fields-target="content"
           class="<%= 'fr-hidden' unless radio_choice == 'yes' %> fr-mt-3w">

        <div class="fr-input-group fr-mb-3w<%= ' fr-input-group--error' if response_form.object.errors[:text].any? %>">
          <%= response_form.label :text,
                t("form_fields.candidate.fields.#{key}.text_label", default: "DÃ©crivez votre situation"),
                class: "fr-label" %>
          <% if t("form_fields.candidate.fields.#{key}.text_hint", default: nil).present? %>
            <span class="fr-hint-text">
              <%= t("form_fields.candidate.fields.#{key}.text_hint") %>
            </span>
          <% end %>
          <%= response_form.text_area :text,
                value: market_attribute_response.text || '',
                class: "fr-input",
                rows: 4,
                aria: { describedby: "text-#{market_attribute_response.id}-messages" } %>
          <div class="fr-messages-group" id="text-<%= market_attribute_response.id %>-messages" aria-live="polite">
            <% if response_form.object.errors[:text].any? %>
              <p class="fr-message fr-message--error">
                <%= response_form.object.errors[:text].first %>
              </p>
            <% end %>
          </div>
        </div>

        <%= render partial: 'candidate/market_applications/market_attribute_responses/fields/file_upload_field',
                   locals: {
                     form: response_form,
                     attribute_response: market_attribute_response
                   } %>
      </div>

      <% if response_form.object.errors[:value].any? %>
        <p class="fr-error-text fr-mt-2w">
          <%= response_form.object.errors[:value].first %>
        </p>
      <% end %>
    </div>
  <% end %>
</div>
