
<% if market_attribute_response.auto? %>
  <% if market_attribute_response.respond_to?(:qualiopi_metadata?) && market_attribute_response.qualiopi_metadata? %>
    <%= form.fields_for :market_attribute_responses, market_attribute_response,
                        child_index: market_attribute_response.id do |response_form| %>
      <%= response_hidden_fields(response_form) %>
    <% end %>

    <div class="certificate-row">
      <div class="certificate-col certificate-col--left">
        <h6 class="fr-mb-2w fr-text--md">
          <%= field_label(market_attribute_response) %>
        </h6>
        <% if field_description(market_attribute_response).present? %>
          <span class="fr-mb-2w fr-text--sm">
            <%= field_description(market_attribute_response) %>
          </span>
        <% end %>
      </div>
      <div class="certificate-col certificate-col--right">
        <div class="fr-mb-1w">
          <%= render 'candidate/market_applications/market_attribute_responses/source_badge', market_attribute_response: market_attribute_response, inline: true %>
        </div>
        <div class="fr-text--sm fr-text--mention-grey">
          <p class="fr-mb-1v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.action_formation') %> :</strong>
            <%= market_attribute_response.action_formation? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
          </p>
          <p class="fr-mb-1v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.bilan_competences') %> :</strong>
            <%= market_attribute_response.bilan_competences? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
          </p>
          <p class="fr-mb-1v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.validation_acquis_experience') %> :</strong>
            <%= market_attribute_response.validation_acquis_experience? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
          </p>
          <p class="fr-mb-1v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.apprentissage') %> :</strong>
            <%= market_attribute_response.apprentissage? ? t('form_fields.candidate.carif_oref.qualiopi.certified') : t('form_fields.candidate.carif_oref.qualiopi.not_certified') %>
          </p>
          <p class="fr-mb-1v">
            <strong><%= t('form_fields.candidate.carif_oref.qualiopi.obtention_via_unite_legale') %> :</strong>
            <%= market_attribute_response.obtention_via_unite_legale? ? t('form_fields.candidate.shared.yes') : t('form_fields.candidate.shared.no') %>
          </p>

          <% if market_attribute_response.specialites.present? %>
            <p class="fr-mb-1v fr-mt-2v">
              <strong><%= t('form_fields.candidate.carif_oref.qualiopi.specialites') %> :</strong>
            </p>
            <ul class="fr-mb-0" style="margin-left: 1.5em;">
              <% market_attribute_response.specialites.each do |specialite| %>
                <li><%= specialite['libelle'] %></li>
              <% end %>
            </ul>
          <% end %>
        </div>
      </div>
    </div>
  <% else %>
    <%= auto_filled_field_display(form, market_attribute_response) %>
  <% end %>
<% else %>
<div class="certificate-row">
  <div class="certificate-col certificate-col--left">
    <h6 class="fr-mb-2w fr-text--md">
      <%= field_label(market_attribute_response) %>
    </h6>
    <% if field_description(market_attribute_response).present? %>
      <span class="fr-mb-2w fr-text--sm">
        <%= field_description(market_attribute_response) %>
      </span>
    <% end %>
  </div>
  <div class="certificate-col certificate-col--right">
    <%= form.fields_for :market_attribute_responses, market_attribute_response,
                        child_index: market_attribute_response.id do |response_form| %>
      <%= response_hidden_fields(response_form) %>
      <%= direct_upload_field documents: market_attribute_response.documents,
                              market_application_identifier: market_attribute_response.market_application.identifier,
                              show_empty: true,
                              deletable: true,
                              wrapper_class: 'fr-mt-2w',
                              form: response_form do %>
        <span class="fr-hint-text fr-text--sm">
          <%= file_upload_hint_text(MarketAttributeResponse::FileUpload::MAX_FILE_SIZE) %>
        </span>
        <%= response_form.file_field :files,
          class: "fr-upload",
          multiple: true,
          direct_upload: true,
          accept: ".pdf,.doc,.docx,.jpg,.jpeg,.png",
          id: "upload-#{market_attribute_response.id}" %>

        <div class="fr-messages-group" id="upload-<%= market_attribute_response.id %>-messages" aria-live="polite">
          <% if response_form.object.errors[:documents].present? %>
            <p class="fr-message fr-message--error">
              <%= response_form.object.errors[:documents].first %>
            </p>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
<% end %>
<hr class="fr-hr">
