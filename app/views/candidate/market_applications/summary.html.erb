<% content_for :title, "#{@market_application.siret} - #{t('candidate.market_applications.steps.summary')}" %>

<%= render "stepper", step: step, wizard_steps: @wizard_steps %>

<div class="fr-grid-row fr-grid-row--center">
  <div class="fr-col-12">
    <div class="fr-mb-5w">
      <h1 class="fr-h1 fr-mb-1w">Synthèse de votre candidature</h1>
      <p class="fr-text--lg fr-mb-0">
        Vérifiez les informations de votre candidature avant de soumettre votre dossier.
      </p>
    </div>

    <% if @presenter %>
      <div class="fr-mb-4w">
        <% fields_by_category = @presenter.fields_by_category_and_subcategory %>
        
        <% if fields_by_category.any? %>
          <% fields_by_category.each do |category, subcategories| %>
            <div class="fr-card fr-mb-2w">
              <%= render 'card_header', title: t("form_fields.candidate.categories.#{category}"), background: "fr-background-alt--grey" %>
              <div class="fr-card__body fr-mt-3w fr-mb-3w">
                <% if category == 'identite_entreprise' %>
                  <div class="fr-card fr-mb-4w fr-card--no-border">
                  <%= render 'card_header', title: 'Informations du marché', background: "fr-background-alt--blue-ecume", color: "fr-text-title--blue-france" do %>
                    <ul class="fr-list fr-mb-3w">
                      <li class="fr-list__item fr-pt-4v fr-pb-4v">
                        <div class="field-layout-container">
                          <div class="field-layout-content">
                            <strong>Nom du marché</strong>
                            <br>
                            <span class="fr-text--sm fr-text--mention-grey"><%= @market_application.public_market.name %></span>
                          </div>
                        </div>
                      </li>
                      <% if @market_application.public_market.lot_name.present? %>
                        <li class="fr-list__item fr-pt-4v fr-pb-4v">
                          <div class="field-layout-container">
                            <div class="field-layout-content">
                              <strong>Nom du lot</strong>
                              <br>
                              <span class="fr-text--sm fr-text--mention-grey"><%= @market_application.public_market.lot_name %></span>
                            </div>
                          </div>
                        </li>
                      <% end %>
                      <li class="fr-list__item fr-pt-4v fr-pb-4v">
                        <div class="field-layout-container">
                          <div class="field-layout-content">
                            <strong>Date et heure limite de remise des plis</strong>
                            <br>
                            <span class="fr-text--sm fr-text--mention-grey"><%= l(@market_application.public_market.deadline, format: '%d/%m/%Y %H:%M') %> (heure de Paris)</span>
                          </div>
                        </div>
                      </li>
                      <li class="fr-list__item fr-pt-4v fr-pb-4v">
                        <div class="field-layout-container">
                          <div class="field-layout-content">
                            <strong>Typologie de marché</strong>
                            <br>
                            <span class="fr-text--sm fr-text--mention-grey">
                              <% if @market_application.public_market.market_type_codes.any? %>
                                <% @market_application.public_market.market_type_codes.each do |market_type_code| %>
                                  <span class="fr-badge fr-badge--sm fr-mr-1w">
                                    <%= t("market_types.#{market_type_code}", default: market_type_code.humanize) %>
                                  </span>
                                <% end %>
                              <% else %>
                                Aucun type de marché défini
                              <% end %>
                            </span>
                          </div>
                        </div>
                      </li>
                    </ul>
                  <% end %>
                  </div>
                <% end %>
                <% subcategories.each_with_index do |(subcategory, fields), subcat_index| %>
                  <div class="fr-card fr-mb-4w fr-card--no-border">
                  <%= render 'card_header', title: t("form_fields.candidate.subcategories.#{subcategory}"), background: "fr-background-alt--blue-ecume", color: "fr-text-title--blue-france" do %>
                    <ul class="fr-list fr-mb-3w">
                      <% fields.each do |field_key| %>
                        <% field = @presenter.field_by_key(field_key) %>
                        <%= render 'field_display',
                              field_key: field_key,
                              field: field,
                              html_tag: :li,
                              wrapper_classes: 'fr-list__item' %>
                      <% end %>
                    </ul>
                  <% end %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <p class="fr-text--sm fr-text--mention-grey">Aucun document requis configuré pour ce marché.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>

<%= render "wizard_nav", submit_label: t('button.submit_summary') %>
