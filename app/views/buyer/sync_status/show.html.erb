<% content_for :title, "#{@public_market.editor.name} - #{t('buyer.sync_status.title_suffix')}" %>

<div class="fr-grid-row fr-grid-row--gutters" style="min-height: 70vh;">
  <div class="fr-col-12 fr-col-lg-7" style="display: flex; align-items: center;">
    <div class="fr-mb-4w"
         data-controller="sync-status"
         data-sync-status-url-value="<%= buyer_sync_status_path(@public_market.identifier, format: :json) %>"
         data-status="<%= @public_market.sync_status %>">

      <div id="sync-status-content">
        <% if @public_market.sync_completed? %>
          <div>
            <h3 class="fr-h3"><%= t('buyer.sync_status.success_title') %></h3>
            <p>
              <%= t('buyer.sync_status.success_message', editor: @public_market.editor.name) %>
            </p>
            <div class="fr-text--sm" data-controller="clipboard">
              <%= t('buyer.sync_status.identifier_notice') %>
              <br />
              <span class="fr-text--bold fr-text--md" data-clipboard-target="text"><%= @public_market.identifier %></span>
              <button type="button"
                      class="fr-btn fr-btn--sm fr-btn--secondary fr-icon-clipboard-line fr-btn--icon-left fr-ml-2w"
                      data-action="click->clipboard#copy"
                      data-clipboard-target="button"
                      title="<%= t('buyer.sync_status.copy') %>">
                <%= t('buyer.sync_status.copy') %>
              </button>
            </div>
            <div class="fr-btns-group fr-btns-group--inline fr-mt-3w">
              <%= link_to t('buyer.sync_status.return_to_editor', editor: @public_market.editor.name),
                          @public_market.editor.build_redirect_url(market: @public_market) || root_path,
                          class: 'fr-btn' %>
            </div>
          </div>

        <% elsif @public_market.sync_failed? %>
          <div>
            <h3 class="fr-h3"><%= t('buyer.sync_status.error_title') %></h3>
            <p>
              <%= t('buyer.sync_status.error_message') %>
            </p>
            <p class="fr-text--sm">
              <%= t('buyer.sync_status.error_hint') %>
            </p>
            <div class="fr-btns-group fr-btns-group--inline fr-mt-3w">
              <%= button_to t('buyer.sync_status.transmit_form'),
                          retry_sync_buyer_public_market_path(@public_market.identifier),
                          method: :post,
                          class: "fr-btn",
                          data: { turbo: false } %>
              <%= link_to t('buyer.sync_status.contact_us'),
                          "mailto:support@voie-rapide.gouv.fr?subject=Erreur de synchronisation pour le marchÃ© #{@public_market.identifier}",
                          class: "fr-btn fr-btn--secondary" %>
            </div>
          </div>
        <% else %>
          <div>
            <h3 class="fr-h3"><%= t('buyer.sync_status.pending_title') %></h3>
            <p>
              <%= t('buyer.sync_status.pending_message', editor: @public_market.editor.name) %>
            </p>
          </div>
        <% end %>
      </div>
    </div>
  </div>

  <div class="fr-col-12 fr-col-lg-1"></div>

  <div class="fr-col-12 fr-col-lg-4" style="display: flex; align-items: center; justify-content: center;">
    <div class="center-content">
      <% if @public_market.sync_completed? %>
        <%= image_tag "sync_status_success.png", alt: t('buyer.sync_status.success_image_alt') %>
      <% elsif @public_market.sync_failed? %>
        <%= image_tag "sync_status_error.png", alt: t('buyer.sync_status.error_image_alt') %>
      <% else %>
        <div class="sync-loader"
             role="img"
             aria-label="<%= t('buyer.sync_status.loading_aria_label') %>"
             data-sync-status-target="loader">
        </div>
      <% end %>
    </div>
  </div>
</div>
