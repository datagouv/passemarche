<% content_for :title, "#{@public_market.editor.name} - #{t('buyer.public_markets.steps.additional_fields')}" %>

<div class="fr-grid-row fr-grid-row--gutters">
  <div class="fr-col-12">
    <%= stepper(
      current_step: step,
      steps: @wizard_steps,
      i18n_scope: 'buyer.public_markets'
    ) %>
  </div>
</div>

<div class="fr-grid-row fr-grid-row--gutters fr-mt-4w">
  <div class="fr-col-12">
    <div data-controller="additional-fields">
      <div class="fr-mb-4w fr-border-default--grey">
        <div class="fr-p-4w">
          <h3 class="fr-h6 fr-mb-3w"><%= t('buyer.public_markets.additional_fields.question') %></h3>
          <div class="fr-radio-group fr-mb-1w">
            <input type="radio" id="additional-yes" name="additional_fields_choice" value="yes" class="fr-radio" data-action="change->additional-fields#showAdditionalFieldsAndEnableSubmit" data-additional-fields-target="yesOption">
            <label class="fr-label" for="additional-yes">
              <%= t('buyer.public_markets.additional_fields.yes_option') %>
            </label>
          </div>
          <div class="fr-radio-group">
            <input type="radio" id="additional-no" name="additional_fields_choice" value="no" class="fr-radio" data-action="change->additional-fields#hideAdditionalFieldsAndEnableSubmit" data-additional-fields-target="noOption">
            <label class="fr-label" for="additional-no">
              <%= t('buyer.public_markets.additional_fields.no_option') %>
            </label>
          </div>
        </div>
      </div>

      <%= form_with model: @public_market, url: wizard_path, local: true, data: { turbo: false } do |form| %>
        <div class="fr-mb-4w" data-additional-fields-target="accordion">
          <div class="fr-mb-4w">
            <h3 class="fr-h5 fr-mb-2w">Vous souhaitez demander des informations complémentaires aux candidats</h3>
            <p class="fr-text--lg fr-mb-0">
              Vous devez sélectionner au moins une information complémentaire avant de poursuivre.
            </p>
          </div>
          <div class="fr-accordions-group fr-mt-4w">
          <% @optional_fields.each_with_index do |(category, subcategories), index| %>
            <%= render 'category_accordion', category: category, index: index, id_prefix: 'accordion-optional' do %>
              <% subcategories.each_with_index do |(subcategory, fields), subcat_index| %>
                <%= render 'subcategory_section',
                      subcategory: subcategory,
                      subcategories: subcategories,
                      is_last: (subcat_index == subcategories.size - 1) do %>
                  <div class="fr-fieldset__content">
                    <% fields.each do |field_key| %>
                      <% field = @presenter.field_by_key(field_key) %>
                      <%= render 'field_checkbox', field_key: field_key, field: field %>
                    <% end %>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>

      <div class="fr-mb-4w">
        <div class="fr-btns-group fr-btns-group--right fr-btns-group--inline">
          <%= link_to previous_wizard_path, class: "fr-btn fr-btn--secondary" do %>
            Précédent
          <% end %>
          <%= form.submit "Suivant",
              class: "fr-btn fr-btn--lg",
              data: { additional_fields_target: "submitButton" },
              disabled: true,
              title: "Suivant" %>
        </div>
      <% end %>
    </div>
  </div>
</div>
