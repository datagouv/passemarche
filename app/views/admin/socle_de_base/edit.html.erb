<%= content_for :page_title, t('admin.socle_de_base.edit.title') %>

<div class="fr-container fr-my-4w">
  <div class="fr-mb-3w">
    <%= link_to admin_socle_de_base_path(@market_attribute), class: "fr-link fr-link--icon-left fr-icon-arrow-left-line" do %>
      <%= t('admin.socle_de_base.show.back') %>
    <% end %>
  </div>

  <h1 class="fr-h2 fr-mb-4w"><%= t('admin.socle_de_base.edit.title') %></h1>

  <%= form_with model: @market_attribute, url: admin_socle_de_base_path(@market_attribute), method: :patch do |f| %>

    <div class="fr-card fr-card--no-border fr-mb-4w">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <h2 class="fr-h4"><%= t('admin.socle_de_base.show.general_info') %></h2>

          <div class="fr-select-group fr-mb-3w">
            <%= f.label :input_type, t('admin.socle_de_base.show.field_type'), class: 'fr-label' %>
            <%= f.select :input_type,
                  @input_types.map { |t| [t.humanize, t] },
                  {}, class: 'fr-select' %>
          </div>

          <div class="fr-checkbox-group fr-mb-3w">
            <%= f.check_box :mandatory, class: 'fr-checkbox' %>
            <%= f.label :mandatory, t('admin.socle_de_base.show.mandatory'), class: 'fr-label' %>
          </div>

          <fieldset class="fr-fieldset fr-mb-3w">
            <legend class="fr-fieldset__legend fr-text--bold"><%= t('admin.socle_de_base.show.market_types') %></legend>
            <% @market_types.each do |mt| %>
              <div class="fr-checkbox-group fr-checkbox-group--inline">
                <%= check_box_tag 'market_attribute[market_type_ids][]', mt.id,
                      @market_attribute.market_type_ids.include?(mt.id),
                      id: "market_type_#{mt.id}" %>
                <%= label_tag "market_type_#{mt.id}", mt.code.humanize, class: 'fr-label' %>
              </div>
            <% end %>
            <%= hidden_field_tag 'market_attribute[market_type_ids][]', '' %>
          </fieldset>
        </div>
      </div>
    </div>

    <div class="fr-card fr-card--no-border fr-mb-4w" data-controller="configuration-toggle">
      <div class="fr-card__body">
        <div class="fr-card__content">
          <h2 class="fr-h4"><%= t('admin.socle_de_base.show.configuration') %></h2>

          <div class="fr-fieldset fr-mb-3w">
            <div class="fr-radio-group">
              <%= radio_button_tag 'market_attribute[api_name]', @market_attribute.api_name.presence || '',
                    @market_attribute.from_api?,
                    id: 'config_api',
                    data: { action: 'configuration-toggle#toggle', configuration_toggle_target: 'radio' } %>
              <%= label_tag 'config_api', t('admin.socle_de_base.show.mode_api'), class: 'fr-label' %>
            </div>
            <div class="fr-radio-group">
              <%= radio_button_tag 'market_attribute[api_name]', '',
                    !@market_attribute.from_api?,
                    id: 'config_manual',
                    data: { action: 'configuration-toggle#toggle', configuration_toggle_target: 'radio' } %>
              <%= label_tag 'config_manual', t('admin.socle_de_base.show.mode_manual'), class: 'fr-label' %>
            </div>
          </div>

          <div class="fr-input-group fr-mb-3w" data-configuration-toggle-target="apiFields"
               <% unless @market_attribute.from_api? %>style="display: none"<% end %>>
            <%= f.label :api_name, t('admin.socle_de_base.show.api_source'), class: 'fr-label' %>
            <%= f.text_field :api_name, class: 'fr-input' %>
          </div>
        </div>
      </div>
    </div>

    <div class="fr-btns-group fr-btns-group--inline">
      <%= f.submit t('admin.socle_de_base.edit.submit'), class: 'fr-btn' %>
      <%= link_to t('admin.socle_de_base.edit.cancel'),
            admin_socle_de_base_path(@market_attribute),
            class: "fr-btn fr-btn--secondary" %>
    </div>
  <% end %>
</div>
