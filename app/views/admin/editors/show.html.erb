<div class="fr-container">
  <div class="fr-grid-row">
    <div class="fr-col-12">
      <nav role="navigation" class="fr-breadcrumb" aria-label="vous êtes ici :">
        <ol class="fr-breadcrumb__list">
          <li>
            <%= link_to "Éditeurs", admin_editors_path, class: "fr-breadcrumb__link" %>
          </li>
          <li>
            <a class="fr-breadcrumb__link" aria-current="page"><%= @editor.name %></a>
          </li>
        </ol>
      </nav>

      <h1><%= @editor.name %></h1>

      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-card">
            <div class="fr-card__body">
              <h2 class="fr-card__title">Informations</h2>
              <div class="fr-card__content">
                <p><strong>Autorisé :</strong>
                  <% if @editor.authorized %>
                    <span class="fr-badge fr-badge--success">Oui</span>
                  <% else %>
                    <span class="fr-badge fr-badge--error">Non</span>
                  <% end %>
                </p>
                <p><strong>Actif :</strong>
                  <% if @editor.active %>
                    <span class="fr-badge fr-badge--success">Oui</span>
                  <% else %>
                    <span class="fr-badge fr-badge--error">Non</span>
                  <% end %>
                </p>
                <p><strong>Marchés MDS :</strong>
                  <% if @editor.can_create_defense_markets %>
                    <span class="fr-badge fr-badge--success">Autorisé</span>
                  <% else %>
                    <span class="fr-badge fr-badge--warning">Non autorisé</span>
                  <% end %>
                </p>
                <p><strong>Créé le :</strong> <%= l(@editor.created_at, format: :long) %></p>
              </div>
            </div>
          </div>
        </div>

        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-card">
            <div class="fr-card__body">
              <h2 class="fr-card__title">Identifiants OAuth</h2>
              <div class="fr-card__content">
                <p><strong>Client ID :</strong> <%= @editor.client_id %></p>
                <p><strong>Client Secret :</strong></p>
                <div data-controller="webhook-secret-toggle">
                  <div class="fr-input-group" style="max-width: 500px;">
                    <input type="text"
                           class="fr-input fr-text--sm"
                           value="<%= '•' * 64 %>"
                           readonly
                           data-webhook-secret-toggle-target="field"
                           data-webhook-secret-toggle-masked-value="<%= '•' * 64 %>"
                           data-webhook-secret-toggle-real-value="<%= @editor.client_secret %>">
                    <button type="button"
                            class="fr-btn fr-btn--sm fr-btn--tertiary-no-outline"
                            data-action="click->webhook-secret-toggle#toggle"
                            data-webhook-secret-toggle-target="button"
                            title="Afficher/Masquer le secret">
                      <span data-webhook-secret-toggle-target="icon" class="fr-icon-eye-line" aria-hidden="true"></span>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="fr-col-12 fr-col-md-6">
          <div class="fr-card">
            <div class="fr-card__body">
              <h2 class="fr-card__title">Statistiques</h2>
              <div class="fr-card__content">
                <p><strong>Total des marchés :</strong> <%= @statistics[:total_markets] %></p>
                <p><strong>Marchés complétés :</strong> <%= @statistics[:completed_markets] %></p>
                <p><strong>Marchés actifs :</strong> <%= @statistics[:active_markets] %></p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="fr-grid-row fr-mt-3w">
        <div class="fr-col-12">
          <div class="fr-card">
            <div class="fr-card__body">
              <h2 class="fr-card__title">Configuration Webhook</h2>
              <div class="fr-card__content">
                <% if @editor.webhook_configured? %>
                  <p><strong>URL de webhook :</strong> <%= @editor.completion_webhook_url %></p>
                  <p><strong>URL de redirection :</strong> <%= @editor.redirect_url || "Non configurée" %></p>
                  <p><strong>Secret configuré :</strong> 
                    <% if @editor.webhook_secret.present? %>
                      <span class="fr-badge fr-badge--success">Oui</span>
                      <div class="fr-mt-2w" data-controller="webhook-secret-toggle">
                        <div class="fr-input-group" style="max-width: 400px;">
                          <input type="text" 
                                 class="fr-input fr-text--sm" 
                                 value="••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••"
                                 readonly
                                 data-webhook-secret-toggle-target="field"
                                 data-webhook-secret-toggle-masked-value="••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••"
                                 data-webhook-secret-toggle-real-value="<%= @editor.webhook_secret %>" />
                          <button type="button" 
                                  class="fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-eye-line"
                                  data-action="click->webhook-secret-toggle#toggle"
                                  data-webhook-secret-toggle-target="button"
                                  title="Afficher le secret">
                            <span data-webhook-secret-toggle-target="icon" class="fr-icon-eye-line" aria-hidden="true"></span>
                          </button>
                        </div>
                      </div>
                    <% else %>
                      <span class="fr-badge fr-badge--warning">Non</span>
                    <% end %>
                  </p>
                <% else %>
                  <p class="fr-text--sm">Webhook non configuré</p>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="fr-mt-3w">
        <%= link_to "Modifier", edit_admin_editor_path(@editor), class: "fr-btn fr-btn--secondary" %>
        <%= link_to "Supprimer", admin_editor_path(@editor), method: :delete,
                    data: { confirm: "Êtes-vous sûr de vouloir supprimer cet éditeur ?" },
                    class: "fr-btn fr-btn--tertiary" %>
        <%= link_to "Retour à la liste", admin_editors_path, class: "fr-btn fr-btn--tertiary-no-outline" %>
      </div>
    </div>
  </div>
</div>
