<div class="fr-container fr-py-6w">
  <div class="fr-mb-4w">
    <nav role="navigation" class="fr-breadcrumb" aria-label="vous Ãªtes ici :">
      <button class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb-buyer">Voir le fil d'Ariane</button>
      <div class="fr-collapse" id="breadcrumb-buyer">
        <ol class="fr-breadcrumb__list">
          <li>
            <a class="fr-breadcrumb__link" href="/">ğŸ  Accueil</a>
          </li>
          <li>
            <a class="fr-breadcrumb__link" aria-current="page">ğŸ Tableau de bord Acheteur</a>
          </li>
        </ol>
      </div>
    </nav>

    <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--middle">
      <div class="fr-col">
        <h1>
          ğŸ›ï¸ Tableau de bord Acheteur ğŸ„
        </h1>
        <p class="fr-text--lead">ğŸ GÃ©rez vos marchÃ©s publics et consultez les candidatures - Ã‰dition NoÃ«l !</p>
      </div>
      <div class="fr-col-auto">
        <% if @current_token&.valid? %>
          <a href="/buyer/markets/new" class="fr-btn fr-btn--primary">
            ğŸ CrÃ©er un marchÃ©
          </a>
        <% else %>
          <div class="fr-tooltip fr-placement-bottom" id="tooltip-auth">
            <button class="fr-btn fr-btn--primary" disabled aria-describedby="tooltip-auth-text">
              ğŸ CrÃ©er un marchÃ©
            </button>
          </div>
          <span class="fr-tooltip__text" id="tooltip-auth-text" role="tooltip">
            ğŸ… Authentification requise
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- ğŸ¬ CANDY CANE DIVIDER ğŸ¬ -->
  <div class="candy-cane-divider"></div>

  <!-- Authentication Warning -->
  <% unless @current_token&.valid? %>
    <div class="fr-alert fr-alert--warning fr-mb-4w">
      <h3 class="fr-alert__title">ğŸ… Authentification requise</h3>
      <p>
        Vous devez Ãªtre authentifiÃ© pour crÃ©er des marchÃ©s.
        <a href="/technical" class="fr-link">ğŸ”‘ Aller au tableau de bord technique</a> pour vous authentifier.
        <br>
        <span style="font-style: italic;">Le PÃ¨re NoÃ«l vÃ©rifie qui est sage !</span>
      </p>
    </div>
  <% end %>

  <!-- Markets List -->
  <div class="fr-mb-4w">
    <h2 class="fr-mb-3w">
      ğŸ„ Mes marchÃ©s
      <span class="fr-badge fr-badge--sm fr-ml-1w"><%= @markets.count %></span>
    </h2>

    <% if @markets.any? %>
      <div class="fr-grid-row fr-grid-row--gutters">
        <% @markets.each do |market| %>
          <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
            <div class="fr-card fr-enlarge-link <%= 'fr-card--green-emeraude' if market.completed_recently? %>">
              <div class="fr-card__body">
                <div class="fr-card__content">
                  <h3 class="fr-card__title">
                    <a href="/buyer/markets/<%= market.identifier %>" class="fr-card__link">
                      ğŸ <%= market.name %>
                    </a>
                  </h3>
                  <p class="fr-card__desc">
                    <% if market.lot_name && !market.lot_name.empty? %>
                      <strong>ğŸ“¦ Lot:</strong> <%= market.lot_name %><br>
                    <% end %>
                    <strong>ğŸ·ï¸ Identifiant:</strong> <code class="fr-text--xs"><%= market.identifier %></code><br>
                    <strong>ğŸ“… CrÃ©Ã©:</strong> <%= relative_time(market.created_at) %><br>
                    <strong>ğŸ‘¥ Candidatures:</strong> <%= market.applications_count %><br>
                    <% if market.status == 'completed' && market.completed_applications_count > 0 %>
                      <strong>âœ… TerminÃ©es:</strong> <%= market.completed_applications_count %>
                    <% end %>
                  </p>
                  <div class="fr-card__end">
                    <p class="fr-badge fr-badge--<%= market.status_color %>">
                      <%= market.status_icon %> <%= market.status_label %>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="fr-callout">
        <h3 class="fr-callout__title">ğŸ„ Aucun marchÃ©</h3>
        <p class="fr-callout__text">
          Vous n'avez pas encore crÃ©Ã© de marchÃ©.
          <% if @current_token&.valid? %>
            <a href="/buyer/markets/new" class="fr-link">ğŸ CrÃ©ez votre premier marchÃ©</a> - C'est NoÃ«l, offrez-vous ce cadeau !
          <% else %>
            ğŸ”‘ Authentifiez-vous d'abord pour crÃ©er un marchÃ©.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>

  <!-- ğŸ¬ CANDY CANE DIVIDER ğŸ¬ -->
  <div class="candy-cane-divider"></div>

  <!-- Help Section -->
  <div class="fr-mt-6w">
    <div class="fr-callout fr-callout--blue-ecume">
      <h3 class="fr-callout__title">ğŸ… Comment Ã§a marche ? - Guide de NoÃ«l</h3>
      <ol>
        <li>ğŸ CrÃ©ez un marchÃ© public avec les informations essentielles</li>
        <li>âš™ï¸ Configurez-le dans Passe MarchÃ© (vous serez redirigÃ© automatiquement)</li>
        <li>ğŸ”” Passe MarchÃ© vous notifiera via webhook une fois la configuration terminÃ©e</li>
        <li>ğŸ„ Les candidats pourront alors postuler Ã  votre marchÃ©</li>
      </ol>
      <p style="margin-top: 1rem; font-style: italic; color: #c41e3a;">
        âœ¨ Que vos marchÃ©s soient remplis de belles candidatures en cette pÃ©riode festive ! âœ¨
      </p>
    </div>
  </div>

  <!-- Christmas message -->
  <div style="text-align: center; margin-top: 2rem; padding: 1rem; background: rgba(196,30,58,0.1); border-radius: 8px;">
    <span style="font-size: 2rem;">ğŸ„ğŸ›ï¸ğŸ</span>
    <p style="color: #228b22; font-weight: bold; margin: 0.5rem 0;">Joyeuses FÃªtes de la part de l'espace Acheteur !</p>
  </div>
</div>
