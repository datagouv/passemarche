<div class="fr-container fr-py-6w">
  <div class="fr-mb-4w">
    <nav role="navigation" class="fr-breadcrumb" aria-label="vous √™tes ici :">
      <button class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb-buyer">Voir le fil d'Ariane</button>
      <div class="fr-collapse" id="breadcrumb-buyer">
        <ol class="fr-breadcrumb__list">
          <li>
            <a class="fr-breadcrumb__link" href="/">Accueil</a>
          </li>
          <li>
            <a class="fr-breadcrumb__link" aria-current="page">Tableau de bord Acheteur</a>
          </li>
        </ol>
      </div>
    </nav>

    <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--middle">
      <div class="fr-col">
        <h1>
          <span class="fr-icon-building-line fr-icon--lg" aria-hidden="true"></span>
          Tableau de bord Acheteur
        </h1>
        <p class="fr-text--lead">G√©rez vos march√©s publics et consultez les candidatures</p>
      </div>
      <div class="fr-col-auto">
        <% if @current_token&.valid? %>
          <a href="/buyer/markets/new" class="fr-btn fr-btn--primary">
            <span class="fr-icon-add-line fr-icon--sm" aria-hidden="true"></span>
            Cr√©er un march√©
          </a>
        <% else %>
          <div class="fr-tooltip fr-placement-bottom" id="tooltip-auth">
            <button class="fr-btn fr-btn--primary" disabled aria-describedby="tooltip-auth-text">
              <span class="fr-icon-add-line fr-icon--sm" aria-hidden="true"></span>
              Cr√©er un march√©
            </button>
          </div>
          <span class="fr-tooltip__text" id="tooltip-auth-text" role="tooltip">
            Authentification requise
          </span>
        <% end %>
      </div>
    </div>
  </div>

  <!-- Authentication Warning -->
  <% unless @current_token&.valid? %>
    <div class="fr-alert fr-alert--warning fr-mb-4w">
      <h3 class="fr-alert__title">‚ö†Ô∏è Authentification requise</h3>
      <p>
        Vous devez √™tre authentifi√© pour cr√©er des march√©s.
        <a href="/technical" class="fr-link">Aller au tableau de bord technique</a> pour vous authentifier.
      </p>
    </div>
  <% end %>

  <!-- Markets List -->
  <div class="fr-mb-4w">
    <h2 class="fr-mb-3w">
      Mes march√©s
      <span class="fr-badge fr-badge--sm fr-ml-1w"><%= @markets.count %></span>
    </h2>

    <% if @markets.any? %>
      <div class="fr-grid-row fr-grid-row--gutters">
        <% @markets.each do |market| %>
          <div class="fr-col-12 fr-col-md-6 fr-col-lg-4">
            <div class="fr-card fr-enlarge-link <%= 'fr-card--green-emeraude' if market.completed_recently? %>">
              <div class="fr-card__body">
                <div class="fr-card__content">
                  <h3 class="fr-card__title">
                    <a href="/buyer/markets/<%= market.identifier %>" class="fr-card__link">
                      <%= market.name %>
                    </a>
                  </h3>
                  <p class="fr-card__desc">
                    <% if market.lot_name && !market.lot_name.empty? %>
                      <strong>Lot:</strong> <%= market.lot_name %><br>
                    <% end %>
                    <strong>Identifiant:</strong> <code class="fr-text--xs"><%= market.identifier %></code><br>
                    <strong>Cr√©√©:</strong> <%= relative_time(market.created_at) %><br>
                    <strong>Candidatures:</strong> <%= market.applications_count %><br>
                    <% if market.status == 'completed' && market.completed_applications_count > 0 %>
                      <strong>Termin√©es:</strong> <%= market.completed_applications_count %>
                    <% end %>
                  </p>
                  <div class="fr-card__end">
                    <p class="fr-badge fr-badge--<%= market.status_color %>">
                      <%= market.status_icon %> <%= market.status_label %>
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="fr-callout">
        <h3 class="fr-callout__title">Aucun march√©</h3>
        <p class="fr-callout__text">
          Vous n'avez pas encore cr√©√© de march√©.
          <% if @current_token&.valid? %>
            <a href="/buyer/markets/new" class="fr-link">Cr√©ez votre premier march√©</a>
          <% else %>
            Authentifiez-vous d'abord pour cr√©er un march√©.
          <% end %>
        </p>
      </div>
    <% end %>
  </div>

  <!-- Help Section -->
  <div class="fr-mt-6w">
    <div class="fr-callout fr-callout--blue-ecume">
      <h3 class="fr-callout__title">üí° Comment √ßa marche ?</h3>
      <ol>
        <li>Cr√©ez un march√© public avec les informations essentielles</li>
        <li>Configurez-le dans Passe March√© (vous serez redirig√© automatiquement)</li>
        <li>Passe March√© vous notifiera via webhook une fois la configuration termin√©e</li>
        <li>Les candidats pourront alors postuler √† votre march√©</li>
      </ol>
    </div>
  </div>
</div>
