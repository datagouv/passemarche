<div class="fr-container fr-py-6w">
  <div class="fr-mb-4w">
    <nav role="navigation" class="fr-breadcrumb" aria-label="vous êtes ici :">
      <button class="fr-breadcrumb__button" aria-expanded="false" aria-controls="breadcrumb-market-show">Voir le fil d'Ariane</button>
      <div class="fr-collapse" id="breadcrumb-market-show">
        <ol class="fr-breadcrumb__list">
          <li>
            <a class="fr-breadcrumb__link" href="/">Accueil</a>
          </li>
          <li>
            <a class="fr-breadcrumb__link" href="/candidate">Candidat</a>
          </li>
          <li>
            <a class="fr-breadcrumb__link" href="/candidate/markets">Marchés</a>
          </li>
          <li>
            <a class="fr-breadcrumb__link" aria-current="page">Détails du marché</a>
          </li>
        </ol>
      </div>
    </nav>

    <div class="fr-grid-row fr-grid-row--gutters fr-grid-row--middle">
      <div class="fr-col">
        <h1><%= @market.name %></h1>
        <p class="fr-text--lead">
          <span class="fr-badge fr-badge--success">
            <%= @market.status_icon %> Ouvert aux candidatures
          </span>
        </p>
      </div>
      <div class="fr-col-auto">
        <a href="/candidate/markets" class="fr-btn fr-btn--secondary">
          <span class="fr-icon-arrow-left-line fr-icon--sm" aria-hidden="true"></span>
          Retour à la liste
        </a>
      </div>
    </div>
  </div>

  <% if @error %>
    <div class="fr-alert fr-alert--error fr-mb-4w">
      <h3 class="fr-alert__title">Erreur</h3>
      <p><%= @error %></p>
    </div>
  <% end %>

  <!-- Tabs Navigation -->
  <div class="fr-tabs">
    <ul class="fr-tabs__list" role="tablist" aria-label="Navigation par onglets">
      <li role="presentation">
        <button class="fr-tabs__tab <%= 'fr-tabs__tab--selected' if @tab == 'overview' || !@tab %>"
                id="tab-button-overview"
                role="tab"
                aria-selected="<%= (@tab == 'overview' || !@tab) ? 'true' : 'false' %>"
                aria-controls="tab-overview">
          <span class="fr-icon-file-text-line fr-icon--sm" aria-hidden="true"></span>
          Vue d'ensemble
        </button>
      </li>
      <li role="presentation">
        <button class="fr-tabs__tab <%= 'fr-tabs__tab--selected' if @tab == 'apply' %>"
                id="tab-button-apply"
                role="tab"
                aria-selected="<%= @tab == 'apply' ? 'true' : 'false' %>"
                aria-controls="tab-apply">
          <span class="fr-icon-send-plane-line fr-icon--sm" aria-hidden="true"></span>
          Candidater
        </button>
      </li>
    </ul>

    <!-- Tab Content: Overview -->
    <div class="fr-tabs__panel <%= 'fr-tabs__panel--selected' if @tab == 'overview' || !@tab %>" id="tab-overview" role="tabpanel" tabindex="0">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-lg-8">
          <div class="fr-card fr-mb-4w">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <div class="fr-table fr-table--layout-fixed">
                  <table>
                    <caption class="sr-only">Détails du marché</caption>
                    <thead>
                      <tr>
                        <th scope="col">Propriété</th>
                        <th scope="col">Valeur</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th scope="row">Nom du marché</th>
                        <td><strong><%= @market.name %></strong></td>
                      </tr>
                      <% if @market.lot_name %>
                        <tr>
                          <th scope="row">Lot</th>
                          <td><%= @market.lot_name %></td>
                        </tr>
                      <% end %>
                      <tr>
                        <th scope="row">Identifiant</th>
                        <td><code><%= @market.identifier %></code></td>
                      </tr>
                      <tr>
                        <th scope="row">Publié</th>
                        <td><%= relative_time(@market.completed_at || @market.created_at) %></td>
                      </tr>
                      <tr>
                        <th scope="row">Candidatures déposées</th>
                        <td>
                          <span class="fr-badge fr-badge--info">
                            <%= @market.applications_count %> candidature<%= 's' if @market.applications_count > 1 %>
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar Info -->
        <div class="fr-col-12 fr-col-lg-4">
          <div class="fr-callout fr-callout--blue-ecume">
            <h3 class="fr-callout__title">
              <span class="fr-icon-information-line fr-icon--sm" aria-hidden="true"></span>
              Comment ça marche ?
            </h3>
            <ol class="fr-callout__text">
              <li><strong>Démarrez</strong> votre candidature (avec ou sans SIRET)</li>
              <li><strong>Complétez</strong> le formulaire dans Voie Rapide</li>
              <li><strong>Fournissez</strong> les documents demandés</li>
              <li><strong>Validez</strong> et soumettez votre candidature</li>
              <li><strong>Recevez</strong> votre attestation de dépôt</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- Tab Content: Apply -->
    <div class="fr-tabs__panel <%= 'fr-tabs__panel--selected' if @tab == 'apply' %>" id="tab-apply" role="tabpanel" tabindex="0">
      <div class="fr-grid-row fr-grid-row--gutters">
        <div class="fr-col-12 fr-col-lg-8">
          <div class="fr-card fr-card--green-emeraude">
            <div class="fr-card__body">
              <div class="fr-card__content">
                <h2 class="fr-mb-3w">
                  <span class="fr-icon-send-plane-line fr-icon--lg" aria-hidden="true"></span>
                  Candidater à ce marché
                </h2>

                <% if @current_token&.valid? %>
                  <p class="fr-mb-3w">
                    Complétez le formulaire ci-dessous pour démarrer votre candidature.
                    Vous serez redirigé vers Voie Rapide pour compléter les informations requises.
                  </p>

                  <form action="/candidate/markets/<%= @market.identifier %>/apply" method="post" class="fr-form-group">
                    <div class="fr-input-group">
                      <label class="fr-label" for="siret">
                        SIRET (optionnel)
                        <span class="fr-hint-text">
                          Si vous renseignez un SIRET, vos informations entreprise seront pré-remplies automatiquement
                        </span>
                      </label>
                      <input
                        class="fr-input"
                        type="text"
                        id="siret"
                        name="siret"
                        placeholder="Ex: 12345678901234"
                        maxlength="14"
                        pattern="[0-9]{14}">
                      <p class="fr-hint-text fr-text--xs">
                        Format : 14 chiffres sans espaces
                      </p>
                    </div>

                    <div class="fr-btns-group fr-btns-group--inline">
                      <button type="submit" class="fr-btn fr-btn--primary fr-btn--lg">
                        <span class="fr-icon-send-plane-fill fr-icon--sm" aria-hidden="true"></span>
                        Démarrer ma candidature
                      </button>
                    </div>

                    <p class="fr-text--xs fr-mt-2w">
                      <span class="fr-icon-information-line fr-icon--sm" aria-hidden="true"></span>
                      Vous serez redirigé vers Voie Rapide pour compléter votre candidature
                    </p>
                  </form>
                <% else %>
                  <div class="fr-alert fr-alert--warning">
                    <h3 class="fr-alert__title">Authentification requise</h3>
                    <p>
                      Vous devez être authentifié pour candidater à ce marché.
                      <a href="/technical" class="fr-link">Aller au tableau de bord technique</a> pour vous authentifier.
                    </p>
                  </div>
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar Info -->
        <div class="fr-col-12 fr-col-lg-4">
          <div class="fr-callout fr-callout--blue-ecume">
            <h3 class="fr-callout__title">
              <span class="fr-icon-information-line fr-icon--sm" aria-hidden="true"></span>
              Comment ça marche ?
            </h3>
            <ol class="fr-callout__text">
              <li><strong>Démarrez</strong> votre candidature (avec ou sans SIRET)</li>
              <li><strong>Complétez</strong> le formulaire dans Voie Rapide</li>
              <li><strong>Fournissez</strong> les documents demandés</li>
              <li><strong>Validez</strong> et soumettez votre candidature</li>
              <li><strong>Recevez</strong> votre attestation de dépôt</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
